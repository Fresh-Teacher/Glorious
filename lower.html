<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Welcome To Glorious Schools, #1 Academic Giant in Ugandan Educational Sector.">
    <meta name="keyword"
        content="Glorious TV, educational videos, Schemes Of Work, Lesson Plans, Lesson Notes, Topical Questions, Luganda Translated Movies, Past Papers">
    <meta name="author" content="Fresh Teacher">
    <link rel="icon" type="image/png" sizes="16x16" href="schoologo-2-150x150.png">
    <link data-n-head="ssr" rel="manifest" href="/manifest.json" data-hid="manifest">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta property="og:site_name" content="Fresh Teacher's Library" />
    <meta property="og:image" content="https://gloriouschools.vercel.app/gallery.jpg" />
      <title>Glorious Examinations Board</title>
    <style>
        :root {
            --primary-color: #FF8C00;
            --secondary-color: #FFA500;
            --light-color: #FFE4B5;
            --dark-color: #D2691E;
            --white-color: #FFFFFF;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: var(--light-color);
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            overflow: hidden;
            padding: 10px;
            text-align: center;
        }
        
        .card {
            background-color: var(--white-color);
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .logo {
            max-width: 150px;
            margin-bottom: 10px;
        }
        
        h1, h2 {
            color: var(--dark-color);
            margin: 10px 0;
        }
        
        .select-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            width: 60%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        select, button {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--secondary-color);
            border-radius: 5px;
            background-color: var(--white-color);
            color: var(--dark-color);
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        select:focus, button:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--secondary-color);
        }
        
        button {
            background-color: var(--primary-color);
            color: var(--white-color);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        button:hover {
            background-color: var(--dark-color);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 12px; /* Adjusted font size */
        }
        
        th, td {
            border: 1px solid var(--secondary-color);
            padding: 6px; /* Adjusted padding */
            text-align: left;
        }
        
        th {
            background-color: var(--primary-color);
            color: var(--white-color);
        }
        @media print {

    body {
        font-size: 10pt;
        font-family: 'Times New Roman', Georgia, serif;
        font-weight: bold;
        margin: 1cm;
    }
    .container {
        width: 100%;
        margin: 0;
        padding: 0;
    }
    button, input[type="file"] {
        display: none !important;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }
    th, td {
        font-size: 20pt; /* Increased font size for cell content */
        border: 1px solid black;
        padding: 2px;
        font-size: 9pt;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: bold;
    }
    /* Adjust column widths */
    th:first-child, td:first-child {
        width: 50%; /* Name column */
    }
    th:not(:first-child):not(:last-child), 
    td:not(:first-child):not(:last-child) {
        width: 10%; /* Subject columns */
    }
    th:last-child, td:last-child {
        width: 10%; /* Agg column */
    }
    input[type="text"] {
        border: none;
        background: none;
        font-family: inherit;
        font-size: inherit;
        font-weight: inherit;
        width: 100%;
        padding: 0;
        margin: 0;
    }
    h1, h2, h3, p {
        margin: 5px 0;
        font-weight: bold;
    }
    /* Additional styles for headers */
    th {
        font-size: 10pt;
        text-transform: uppercase;
    }
    /* Hide header and footer */
    @page {
        margin: 0;
    }
    body::before, body::after {
        content: none !important;
    }
    /* Hide any other elements that might appear in the print version */
    header, footer, .no-print {
        display: none !important;
    }
    /* Remove other designs but keep the table structure */
    *:not(table):not(tr):not(th):not(td) {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        text-shadow: none !important;
    }
}

  /* Hide the header and footer added by the browser */
  @page {
        margin: 0;
    }
    body {
        margin: 1cm;
    }
    /* Hide header */
    body::before {
        content: none !important;
    }
    /* Hide footer */
    body::after {
        content: none !important;
    }

     /* Hide any other elements that might appear in the print version */
     header, footer, .no-print {
        display: none !important;
    }
    /* Hide the original header */
    header, .header {
        display: none !important;
    }

    /* Style for the new title */
    .pdf-title {
        text-align: center;
        font-size: 16pt;
        font-weight: bold;
        margin-bottom: 20px;
        line-height: 1.4;
    }

    .pdf-title h1 {
        margin: 0;
        padding: 0;
    }

    .pdf-title h2 {
        margin: 5px 0 0 0;
        padding: 0;
        font-size: 14pt;
    }

    .pdf-title h3 {
        margin: 5px 0 0 0;
        padding: 0;
        font-size: 12pt;
    }

    table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 12px;
}

th, td {
    border: 1px solid var(--secondary-color);
    padding: 4px;
    text-align: left;
}

input[type="text"] {
    width: 35px;
    padding: 2px;
    border: 1px solid var(--secondary-color);
    border-radius: 3px;
}

@media screen and (max-width: 768px) {
    table {
        font-size: 10px;
    }

    th, td {
        padding: 2px;
    }

    input[type="text"] {
        width: 30px;
        padding: 1px;
    }
}

@media screen and (max-width: 480px) {
    table {
        font-size: 8px;
    }

    th, td {
        padding: 1px;
    }

    input[type="text"] {
        width: 25px;
        padding: 0;
    }
}
        input[type="text"] {
            width: 40px;
            padding: 4px;
            border: 1px solid var(--secondary-color);
            border-radius: 3px;
        }
        
        .subject-aggregate, .total-aggregates, .division {
            font-size: 12px;
        }
        
        .info-section {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .grade-info, .division-info {
            flex-basis: 48%;
            background-color: var(--light-color);
            border-radius: 5px;
            padding: 15px;
        }
        
        @media screen and (max-width: 768px) {
            table {
                font-size: 10px; /* Adjusted font size for smaller screens */
            }
        
            th, td {
                padding: 4px; /* Adjusted padding for smaller screens */
            }
        
            input[type="text"] {
                width: 30px;
                padding: 2px;
            }
        
            .subject-aggregate, .total-aggregates, .division {
                font-size: 10px;
            }
        }
        
        @media screen and (max-width: 480px) {
            table {
                font-size: 8px; /* Adjusted font size for smallest screens */
            }
        
            th, td {
                padding: 2px; /* Adjusted padding for smallest screens */
            }
        
            input[type="text"] {
                width: 25px;
                padding: 1px;
            }
        
            .subject-aggregate, .total-aggregates, .division {
                font-size: 9px;
            }
        }
        
        .grade-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .grade-table th, .grade-table td {
            border: 1px solid var(--secondary-color);
            padding: 6px; /* Adjusted padding */
            text-align: left;
        }
        
        .grade-table th {
            background-color: var(--primary-color);
            color: var(--white-color);
        }
        
        .grade-table tr:nth-child(even) {
            background-color: var(--light-color);
        }
        
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .info-table th, .info-table td {
            border: 1px solid var(--secondary-color);
            padding: 6px; /* Adjusted padding */
            text-align: left;
        }
        
        .info-table th {
            background-color: var(--primary-color);
            color: var(--white-color);
        }
        
        .invalid-input {
            background-color: #ffdddd;
            border: 1px solid #ff0000;
            color: #ff0000;
        }
        
        #saveDraftBtn, #importDataBtn {
            margin-top: 20px;
            margin-right: 10px;
            margin-left: 10px;
        }
        
        #fileInput {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }
        
        .notification.success {
            background-color: #4CAF50;
        }
        
        .notification.error {
            background-color: #f44336;
        }
        
        .notification.info {
            background-color: #2196F3;
        }
        
        .notification-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding-top: 20px;
            z-index: 1000;
        }
        
        .progress-bar {
            width: 100%;
            height: 5px;
            background-color: rgba(255, 255, 255, 0.3);
            position: absolute;
            bottom: 0;
            left: 0;
            border-radius: 0 0 5px 5px;
        }
        
        .progress {
            width: 0;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 0 0 5px 5px;
            transition: width 0.3s linear;
        }

        table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 12px;
}

th, td {
    border: 1px solid var(--secondary-color);
    padding: 4px;
    text-align: left;
}

input[type="text"] {
    width: 35px;
    padding: 2px;
    border: 1px solid var(--secondary-color);
    border-radius: 3px;
}

@media screen and (max-width: 768px) {
    table {
        font-size: 10px;
    }

    th, td {
        padding: 2px;
    }

    input[type="text"] {
        width: 30px;
        padding: 1px;
    }
}

@media screen and (max-width: 480px) {
    table {
        font-size: 8px;
    }

    th, td {
        padding: 1px;
    }

    input[type="text"] {
        width: 25px;
        padding: 0;
    }
}
.minor-subject {
    background-color: #f0f0f0;
    color: #666;
}

input.minor-subject {
    background-color: #f8f8f8;
}

.analysis-section {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
}

.analysis-section > div {
    flex-basis: calc(50% - 10px);
    margin-bottom: 20px;
}

.analysis-section table {
    width: 100%;
    border-collapse: collapse;
}

.analysis-section th, .analysis-section td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
}

.analysis-section th {
    background-color: #f2f2f2;
}

.analysis-section h3 {
        page-break-inside: avoid;
        margin-top: 20px;
    }

        /* Add these new styles */
        .analysis-wrapper {
        page-break-inside: avoid;
    }

    .analysis-section {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

    .analysis-section > div {
        flex-basis: 100%;
        margin-bottom: 20px;
    }

    .analysis-section table {
        font-size: 10pt; /* Reduce font size to fit more content */
    }

    .analysis-section h3 {
        margin-top: 10px;
        margin-bottom: 5px;
    }

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    border-radius: 5px;
    color: white;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.notification.success {
    background-color: #4CAF50;
}

.notification.error {
    background-color: #f44336;
}

.notification.info {
    background-color: #2196F3;
}
#importDataBtn, #fileInput, #saveDraftBtn, #exportBtn {
            display: none;
        }
/* Navbar styles */
.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #ff8c00;
    padding: 0.5rem 1rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
}

.navbar .logo {
    display: flex;
    align-items: center;
}

.navbar .logo img {
    width: 40px;
    height: auto;
    margin-right: 10px;
}

.navbar .logo .title {
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
}

.navbar ul {
    list-style: none;
    display: flex;
    margin: 0;
    padding: 0;
}

.navbar ul li {
    margin-left: 1rem;
}

.navbar ul li a {
    color: white;
    text-decoration: none;
    padding: 0.5rem 1rem;
    display: block;
    transition: background-color 0.3s ease;
    font-size: 1rem;
    border-radius: 5px;
}

.navbar ul li a:hover {
    background-color: #e06b00;
}

.navbar .toggle {
    display: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
}

.logout-button {
    padding: 0.5rem 1rem;
    background-color: #e06b00;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.logout-button:hover {
    background-color: #d65600;
}

/* Animated title */
@keyframes colorChange {
    0% { color: white; }
    50% { color: #FFE0B2; }
    100% { color: white; }
}

.animated-title {
    animation: colorChange 4s infinite;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
}

/* Footer styles */
/* Footer styles */
.footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #ff8c00;
    color: white;
    text-align: center;
    padding: 0.5rem 0;
    font-size: 0.9rem;
    box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
    z-index: 1000;
}


.footer p {
    margin: 0;
}

/* Responsive styles */
@media (max-width: 768px) {
    .navbar {
        flex-direction: column;
        align-items: flex-start;
    }

    .navbar ul {
        flex-direction: column;
        width: 100%;
        display: none;
    }

    .navbar ul.show {
        display: flex;
    }

    .navbar ul li {
        margin: 0;
        width: 100%;
    }

    .navbar ul li a {
        padding: 1rem;
        border-radius: 0;
    }

    .navbar .toggle {
        display: block;
        align-self: flex-end;
        position: absolute;
        top: 1rem;
        right: 1rem;
    }

    .navbar .logo {
        margin-bottom: 1rem;
    }
}

/* Additional styles to ensure navbar doesn't overlap content and footer stays at bottom */
body {
    padding-top: 60px; /* Adjust this value based on your navbar height */
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

main {
    flex: 1 0 auto;
}

@media (max-width: 768px) {
    body {
        padding-top: 100px; /* Increase padding for mobile view */
    }
}
#approvalTable {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

#approvalTable th, #approvalTable td {
    border: 1px solid var(--secondary-color);
    padding: 8px;
    text-align: left;
}

#approvalTable th {
    background-color: var(--primary-color);
    color: var(--white-color);
    width: 30%;
}

#approvalTable td {
    height: 30px; /* Provides space for handwritten entries */
}

@media print {
    #approvalTable {
        page-break-inside: avoid;
    }

    #approvalTable th, #approvalTable td {
        border: 2px solid black;
    }

    #approvalTable th {
        background-color: white;
        color: black;
    }
}
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.6);
    backdrop-filter: blur(5px);
}

.modal-content {
    background: linear-gradient(135deg, #FFA500, #D2691E);
    margin: 15% auto;
    padding: 30px;
    border: none;
    border-radius: 15px;
    width: 90%;
    max-width: 500px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    color: white;
    font-family: Arial, sans-serif;
}

.modal-content h2 {
    margin-top: 0;
    font-size: 24px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
}

.modal-content p {
    font-size: 16px;
    margin-bottom: 15px;
}

#countdown {
    font-size: 24px;
    font-weight: bold;
    color: #FFD700;
}

#cancelRefresh {
    margin-top: 20px;
    padding: 10px 20px;
    background-color: rgba(255,255,255,0.2);
    color: white;
    border: 2px solid white;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
}

#cancelRefresh:hover {
    background-color: white;
    color: #D2691E;
}
@media print {

    body {
        font-size: 10pt;
        font-family: 'Times New Roman', Georgia, serif;
        font-weight: bold;
        margin: 1cm;
    }
    .container {
        width: 100%;
        margin: 0;
        padding: 0;
    }
    button, input[type="file"] {
        display: none !important;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        margin-bottom: 20px;
    }
    th, td {
        border: 1px solid black;
        padding: 2px;
        font-size: 9pt;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-weight: bold;
        text-align: center;
    }
    /* Adjust column widths for main grade table */
    #gradeTable th:first-child, #gradeTable td:first-child {
        width: 50%; /* Name column */
        text-align: left;
    }
    #gradeTable th:not(:first-child):not(:last-child), 
    #gradeTable td:not(:first-child):not(:last-child) {
        width: 10%; /* Subject columns */
    }
    #gradeTable th:last-child, #gradeTable td:last-child {
        width: 10%; /* Agg column */
    }
    input[type="text"] {
        border: none;
        background: none;
        font-family: inherit;
        font-size: inherit;
        font-weight: inherit;
        width: 100%;
        padding: 0;
        margin: 0;
        text-align: center;
    }
    h1, h2, h3, p {
        margin: 5px 0;
        font-weight: bold;
        text-align: center;
    }
    /* Additional styles for headers */
    th {
        font-size: 10pt;
        text-transform: uppercase;
    }
    /* Hide header and footer */
    @page {
        margin: 0;
    }
    body::before, body::after {
        content: none !important;
    }
    /* Hide any other elements that might appear in the print version */
    header, footer, .no-print {
        display: none !important;
    }
    /* Remove other designs but keep the table structure */
    *:not(table):not(tr):not(th):not(td) {
        background: none !important;
        border: none !important;
        box-shadow: none !important;
        text-shadow: none !important;
    }
    
    /* Styles for analysis tables */
    .analysis-section table {
        margin-top: 20px;
    }
    .analysis-section h3 {
        page-break-inside: avoid;
        margin-top: 20px;
    }
    
    /* Ensure all table cells in all tables have thick borders */
    table, th, td {
        border: 2px solid black !important;
    }
    
    /* Specific styles for approval table */
    #approvalTable th {
        width: 30%;
        text-align: left;
    }
    #approvalTable td {
        height: 30px;
        text-align: left;
    }
}

#gradeTable th {
    text-transform: uppercase;
}
#gradeTable th {
    text-transform: uppercase;
}

@media print {
    #gradeTableHeader th {
        font-weight: bold !important;
        color: black !important;
        background-color: white !important;
    }
}
@media print {
    #divisionAnalysisTable th {
        font-weight: bold !important;
        color: black !important;
        background-color: white !important;
    }
}@media print {
    #aggregateAnalysisTable th {
        font-weight: bold !important;
        color: black !important;
        background-color: white !important;
    }
}@media print {
    #subjectAnalysisTable th {
        font-weight: bold !important;
        color: black !important;
        background-color: white !important;
    }
}
.name-options {
    display: none;
    margin-left: 10px;
}

.name-options button {
    padding: 2px 5px;
    margin-right: 5px;
    cursor: pointer;
}
.model {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.model-content {
    background: linear-gradient(135deg, #FFA500, #8B4513);
    padding: 30px;
    border-radius: 10px;
    text-align: center;
    color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    max-width: 400px;
    width: 90%;
}

.model-content h2 {
    margin-bottom: 20px;
    font-size: 24px;
}

#editNameInput {
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    font-size: 18px;
    border: none;
    border-radius: 5px;
    background-color: rgba(255, 255, 255, 0.9);
}

.model-buttons {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 15px;
}

.model-buttons button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    transition: background-color 0.3s, transform 0.1s;
}

#confirmButton {
    background-color: #4CAF50;
    color: white;
}

#confirmButton:hover {
    background-color: #45a049;
}

#cancelButton {
    background-color: #f44336;
    color: white;
}

#cancelButton:hover {
    background-color: #da190b;
}

.model-buttons button:active {
    transform: scale(0.98);
}

.flash-message {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #FF8C00;
    color: white;
    padding: 15px;
    border-radius: 5px;
    z-index: 1001;
    transition: opacity 0.5s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.flash-message.fade-out {
    opacity: 0;
}
    </style>
</head>
<script>
    // navbar-script.js
function toggleMenu() {
    const navLinks = document.getElementById('nav-links');
    navLinks.classList.toggle('show');
}

function logout() {
    localStorage.removeItem("rememberMe");
    localStorage.removeItem("email");
    localStorage.removeItem("password");
    localStorage.removeItem("isLoggedIn");
    sessionStorage.removeItem("email");
    sessionStorage.removeItem("password");
    sessionStorage.removeItem("isLoggedIn");
    sessionStorage.removeItem("intendedPage");
    window.location.href = 'index.html';
}

function checkAuth(page) {
    if (localStorage.getItem('isLoggedIn') === 'true' || sessionStorage.getItem('isLoggedIn') === 'true') {
        window.location.href = page;
    } else {
        sessionStorage.setItem("intendedPage", page);
        showLoginMessage();
    }
}

function showLoginMessage() {
    // Implement this function if you want to show a login message
    console.log("Please log in to access this page.");
}

function checkAuthStatus() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || sessionStorage.getItem('isLoggedIn') === 'true';
    document.getElementById("logout-nav").style.display = isLoggedIn ? "block" : "none";
}

document.addEventListener("DOMContentLoaded", function() {
    checkAuthStatus();
    document.getElementById('currentYear').textContent = new Date().getFullYear();
});
</script>
<body>
     <!-- Add the navbar -->
     <!-- <div class="navbar">
        <div class="logo">
            <img src="schoologo-2-150x150.png" alt="School Logo">
            <div class="title animated-title">Glorious Schools</div>
        </div>
        <span class="toggle" onclick="toggleMenu()">&#9776;</span>
        <ul id="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="javascript:void(0);" onclick="checkAuth('games.html')">Games</a></li>
            <li><a href="javascript:void(0);" onclick="checkAuth('videos.html')">Videos</a></li>     
            <li><a href="javascript:void(0);" onclick="checkAuth('library.html')">Library</a></li>
            <li id="logout-nav" style="display: none;"><button class="logout-button" onclick="logout()">Logout</button></li>
        </ul>
    </div> -->
    <div class="pdf-title">
        <h2>GLORIOUS KINDERGARTEN AND PRIMARY SCHOOL</h2>
        <h2>___________ EXAMS RESULTS TERM ___________ 2024</h2>
        <h2 id="classStreamTitle"></h2>

    </div>
    <div id="pdfModal" class="modal">
        <div class="modal-content">
            <h2>PDF Generated Successfully ✔️</h2>
            <p>The PDF file has been saved to your device.</p>
            <p>Returning to the start page in <span id="countdown">5</span> seconds.</p>
            <button id="cancelRefresh">Stay on this page</button>
        </div>
    </div>
    <div class="container">
        <div id="welcomePage" class="card">
            <center>
                <img src="schoologo-2-150x150.png" alt="School Logo" class="logo">
                <h1>Glorious Examinations Board</h1>
            </center>
            <h2>Select Class and Stream</h2>
            <div class="select-container">
                <select id="classSelect">
                    <option value="" disabled selected>Select Class</option>
                </select>
                <select id="streamSelect" style="display: none;">
                    <option value="" disabled selected>Select Stream</option>
                </select>
                <button id="goToGradingBtn" style="display: none;">Go to Grading</button>
            </div>
        </div>

        <div id="gradingPage" style="display: none;">
            <div class="card">
               
                <table id="gradeTable">
                  
                    <thead id="gradeTableHeader">
                        <!-- The header will be dynamically populated -->
                    </thead>
                    <tbody id="gradeTableBody">
                        <!-- Student rows will be added here dynamically -->
                    </tbody>
                </table>
                <button id="exportJsonBtn">Export JSON</button>
                <button id="importJsonBtn">Import JSON</button>
                <input type="file" id="jsonFileInput" style="display: none;">   
                     <button id="generatePdfBtn" style="margin-top: 20px;">Print Preview 🖶</button>
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;">

                <button id="importDataBtn" style="margin-top: 20px;">Import Data</button>
                <input type="file" id="fileInput" accept=".json">
                <button id="saveDraftBtn" style="margin-top: 20px;">Save Draft</button>
                <button id="exportBtn" style="margin-top: 20px;">Export Results</button>
              </div>
              <div class="analysis-wrapper">
                <div class="analysis-section">
                       <h3>Division Analysis</h3>
                <table id="divisionAnalysisTable">
                    <thead>
                        <tr>
                            <th>Division</th>
                            <th>Number of Pupils</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Division analysis rows will be added here dynamically -->
                    </tbody>
                </table>
            
                <h3>Aggregate Analysis</h3>
                <table id="aggregateAnalysisTable">
                    <thead>
                        <tr id="aggregateRow">
                            <th>AGGREGATE:</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="pupilCountRow">
                            <th>NUMBER OF PUPILS:</th>
                        </tr>
                    </tbody>
                </table>
<br>
                <h3>Subject Analysis</h3>
                <table id="subjectAnalysisTable">
                    <thead>
                        <tr>
                            <th>Subject</th>
                            <th>D1</th>
                            <th>D2</th>
                            <th>C3</th>
                            <th>C4</th>
                            <th>C5</th>
                            <th>C6</th>
                            <th>P7</th>
                            <th>P8</th>
                            <th>F9</th>
                            <th>X</th>
                            <th>1st Grades</th>
                            <th>%</th>
                            <th>POS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Subject analysis rows will be added here dynamically -->
                    </tbody>
                </table>
                <h3>Approval Section</h3>
                <table id="approvalTable">
                    <tbody>
                        <tr>
                            <th>Class Teacher's Comment:</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th>Class Teacher's Name:</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th>Class Teacher's Signature:</th>
                            <td></td>
                        </tr>
                        <tr>
                            <th>Date of Submission:</th>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div>
<!-- Add the footer -->
<br><br>
<footer class="footer">
    
    <div>
        <p>&copy; Glorious Schools <span id="currentYear"></span></p>
    </div>
</footer>
    <script>
function getTableData() {
    const rows = document.querySelectorAll('#gradeTable tbody tr');
    const data = {
        class: classSelect.value,
        stream: streamSelect.value,
        students: []
    };
    const isPrimaryThree = classSelect.value === 'Primary Three';

    rows.forEach(row => {
        const student = {
            name: row.querySelector('.student-name')?.textContent || '',
            eng: { marks: "", grade: "" },
            mtc: { marks: "", grade: "" },
            lit: { 
                a: { marks: "" },
                b: { marks: "" },
                avg: "",
                grade: ""
            },
            re: { marks: "", grade: "" },
            lit2: { marks: "", grade: "" },
            lug: { marks: "", grade: "" },
            totalAggregates: "",
            division: ""
        };
        
        if (isPrimaryThree) {
            student.ict = { marks: "", grade: "" };
        }

        const inputs = row.querySelectorAll('.subject-mark');
        const aggregates = row.querySelectorAll('.subject-aggregate');

        student.eng.marks = inputs[0]?.value || "";
        student.eng.grade = aggregates[0]?.textContent || "";
        student.mtc.marks = inputs[1]?.value || "";
        student.mtc.grade = aggregates[1]?.textContent || "";
        student.lit.a.marks = inputs[2]?.value || "";
        student.lit.b.marks = inputs[3]?.value || "";
        student.lit.avg = row.querySelector('.re-mean')?.textContent || "";
        student.lit.grade = row.querySelector('.re-aggregate')?.textContent || "";
        student.re.marks = inputs[4]?.value || "";
        student.re.grade = aggregates[3]?.textContent || "";
        student.lit2.marks = inputs[5]?.value || "";
        student.lit2.grade = aggregates[4]?.textContent || "";
        student.lug.marks = inputs[6]?.value || "";
        student.lug.grade = aggregates[5]?.textContent || "";

        if (isPrimaryThree) {
            student.ict.marks = inputs[7]?.value || "";
            student.ict.grade = aggregates[6]?.textContent || "";
        }

        student.totalAggregates = row.querySelector('.total-aggregates')?.textContent || "";
        student.division = row.querySelector('.division')?.textContent || "";
        data.students.push(student);
    });
    return data;
}

function saveTableAsJSON() {
    try {
        const tableData = getTableData();
        const jsonString = JSON.stringify(tableData, null, 2);
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${tableData.class}_${tableData.stream}_Results.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showNotification("Data exported as JSON successfully!", "success");
    } catch (error) {
        console.error("Error exporting data:", error);
        showNotification("Error exporting data. Please try again.", "error");
    }
}

function importJSON() {
    document.getElementById('jsonFileInput').click();
}

function handleJSONImport(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const jsonData = JSON.parse(e.target.result);
                if (!jsonData.class || !jsonData.stream || !Array.isArray(jsonData.students)) {
                    throw new Error("Invalid JSON structure");
                }
                populateTableFromJSON(jsonData);
                showNotification("Data imported from JSON successfully!", "success");
            } catch (error) {
                console.error("JSON import error:", error);
                showNotification(`Error importing JSON data: ${error.message}`, "error");
            }
        };
        reader.onerror = function(e) {
            console.error("FileReader error:", e);
            showNotification("Error reading the file", "error");
        };
        reader.readAsText(file);
    }
}

function populateTableFromJSON(data) {
    // Set the class and stream selects
    if (data.class && classSelect.querySelector(`option[value="${data.class}"]`)) {
        classSelect.value = data.class;
        populateStreamSelect(data.class);
    } else {
        throw new Error("Invalid class in JSON data");
    }

    if (data.stream && streamSelect.querySelector(`option[value="${data.stream}"]`)) {
        streamSelect.value = data.stream;
    } else {
        throw new Error("Invalid stream in JSON data");
    }

    // Show the grading page
    welcomePage.style.display = 'none';
    gradingPage.style.display = 'block';

    // Set the title
    classStreamTitle.textContent = `${data.class} - ${data.stream}`;

    // Clear existing table rows
    const tableBody = document.getElementById('gradeTableBody');
    tableBody.innerHTML = '';

    const isPrimaryThree = data.class === 'Primary Three';

    // Populate the table with imported data
    data.students.forEach((student, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="name-cell">${index + 1}. <span class="student-name">${student.name || ''}</span></td>
            <td><input type="text" class="subject-mark main-subject" value="${student.eng?.marks || ''}" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td class="subject-aggregate">${student.eng?.grade || ''}</td>
            <td><input type="text" class="subject-mark main-subject" value="${student.mtc?.marks || ''}" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td class="subject-aggregate">${student.mtc?.grade || ''}</td>
            <td><input type="text" class="subject-mark main-subject re-subject" data-subject="LIT A" value="${student.lit?.a?.marks || ''}" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td><input type="text" class="subject-mark main-subject re-subject" data-subject="LIT B" value="${student.lit?.b?.marks || ''}" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td class="re-mean">${student.lit?.avg || ''}</td>
            <td class="re-aggregate">${student.lit?.grade || ''}</td>
            <td><input type="text" class="subject-mark main-subject" value="${student.re?.marks || ''}" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td class="subject-aggregate">${student.re?.grade || ''}</td>
            <td><input type="text" class="subject-mark minor-subject" value="${student.lit2?.marks || ''}" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td class="subject-aggregate minor-subject">${student.lit2?.grade || ''}</td>
            <td><input type="text" class="subject-mark minor-subject" value="${student.lug?.marks || ''}" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
            <td class="subject-aggregate minor-subject">${student.lug?.grade || ''}</td>
        `;

        if (isPrimaryThree) {
            row.innerHTML += `
                <td><input type="text" class="subject-mark minor-subject" value="${student.ict?.marks || ''}" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate minor-subject">${student.ict?.grade || ''}</td>
            `;
        }

        row.innerHTML += `
            <td class="total-aggregates">${student.totalAggregates || ''}</td>
            <td class="division">${student.division || ''}</td>
        `;

        const inputs = row.querySelectorAll('.subject-mark');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9.-]/g, '');
                validateAndUpdateResults(this);
            });
            input.addEventListener('blur', () => validateAndUpdateResults(input));
        });

        tableBody.appendChild(row);
    });

    // Trigger update for all inputs to recalculate grades and aggregates
    tableBody.querySelectorAll('.subject-mark').forEach(input => {
        validateAndUpdateResults(input);
    });

    
    // Reattach event listeners and update results
    const inputs = document.querySelectorAll('.subject-mark');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9-]/g, '');
            validateAndUpdateResults(this);
        });
        input.addEventListener('blur', () => validateAndUpdateResults(input));
        validateAndUpdateResults(input);
    });
}

function generatePDF() {
    // Hide elements we don't want in the PDF
    const welcomePage = document.getElementById('welcomePage');
    const importDataBtn = document.getElementById('importDataBtn');
    const fileInput = document.getElementById('fileInput');
    const saveDraftBtn = document.getElementById('saveDraftBtn');
    const exportBtn = document.getElementById('exportBtn');
    const generatePdfBtn = document.getElementById('generatePdfBtn');

    welcomePage.style.display = 'none';
    importDataBtn.style.display = 'none';
    fileInput.style.display = 'none';
    saveDraftBtn.style.display = 'none';
    exportBtn.style.display = 'none';
    generatePdfBtn.style.display = 'none';

    // Show the grading page if it's not already visible
    const gradingPage = document.getElementById('gradingPage');
    gradingPage.style.display = 'block';

    // Print the page
    window.print();

    // Restore the hidden elements
    setTimeout(() => {
        welcomePage.style.display = 'block';
        importDataBtn.style.display = 'inline-block';
        fileInput.style.display = 'inline-block';
        saveDraftBtn.style.display = 'inline-block';
        exportBtn.style.display = 'inline-block';
        generatePdfBtn.style.display = 'inline-block';

        // Show the modal
        showModal();
    }, 100);
}

function showModal() {
    const modal = document.getElementById('pdfModal');
    const countdown = document.getElementById('countdown');
    const cancelBtn = document.getElementById('cancelRefresh');
    let secondsLeft = 5;

    modal.style.display = 'block';

    const countdownInterval = setInterval(() => {
        secondsLeft--;
        countdown.textContent = secondsLeft;

        if (secondsLeft <= 0) {
            clearInterval(countdownInterval);
            location.reload();
        }
    }, 1000);

    cancelBtn.onclick = () => {
        clearInterval(countdownInterval);
        modal.style.display = 'none';
    };
}

// Add event listener for the Generate PDF button
document.getElementById('generatePdfBtn').addEventListener('click', generatePDF);

function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = '1';
    }, 10);

    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, duration);
}

document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('exportJsonBtn').addEventListener('click', saveTableAsJSON);
    document.getElementById('importJsonBtn').addEventListener('click', importJSON);
    document.getElementById('jsonFileInput').addEventListener('change', handleJSONImport);
    document.getElementById('generatePdfBtn').addEventListener('click', generatePDF);
});
        function updateDivisionAnalysisTable() {
    const table = document.getElementById('divisionAnalysisTable').getElementsByTagName('tbody')[0];
    table.innerHTML = ''; // Clear existing rows

    const divisionCounts = {
        '1': 0,
        '2': 0,
        '3': 0,
        '4': 0,
        'U': 0,
        'X': 0
    };

    const divisionCells = document.querySelectorAll('#gradeTable .division');

    divisionCells.forEach(cell => {
        const division = cell.textContent.trim();
        if (division in divisionCounts) {
            divisionCounts[division]++;
        }
    });

    Object.entries(divisionCounts).forEach(([division, count]) => {
        const row = table.insertRow();
        row.insertCell().textContent = division;
        row.insertCell().textContent = count;
    });
}

function updateAnalysisTables() {
    updateSubjectAnalysisTable(); // Rename the existing function for clarity
    updateAggregateAnalysisTable();
    updateDivisionAnalysisTable(); // Add this line
}

function updateSubjectAnalysisTable() {
    const table = document.getElementById('subjectAnalysisTable').getElementsByTagName('tbody')[0];
    table.innerHTML = '';

    const isLowerPrimary = ['Primary One', 'Primary Two', 'Primary Three'].includes(classSelect.value);
    const subjects = isLowerPrimary ? ['ENG', 'MTC', 'LIT A', 'LIT B', 'R.E', 'LIT 2', 'LUG'] : ['ENG', 'MTC', 'SCIE', 'SST'];
    const grades = ['D1', 'D2', 'C3', 'C4', 'C5', 'C6', 'P7', 'P8', 'F9', 'X'];

    // Get total number of pupils
    const totalPupils = document.querySelectorAll('#gradeTable tbody tr').length;

    const subjectData = {};

    subjects.forEach(subject => {
        const row = table.insertRow();
        row.insertCell().textContent = subject;

        const counts = grades.map(grade => countGradesForSubject(subject, grade));
        counts.forEach(count => {
            row.insertCell().textContent = count;
        });

        const firstGradesCount = counts[0] + counts[1] + counts[2]; // D1 + D2 + C3 count
        row.insertCell().textContent = firstGradesCount;

        // Calculate percentage
        const percentage = (firstGradesCount / totalPupils) * 100;
        row.insertCell().textContent = percentage.toFixed(2) + '%';

        subjectData[subject] = firstGradesCount;
    });

    const subjectPositions = calculateSubjectPositions(subjectData);

    // Add subject positions
    Array.from(table.rows).forEach((row, index) => {
        const subject = subjects[index];
        row.insertCell().textContent = subjectPositions[subject];
    });
}

function countGradesForSubject(subject, grade) {
    const subjectIndex = ['ENG', 'MTC', 'SCIE', 'SST'].indexOf(subject) * 2 + 2;
    const cells = document.querySelectorAll(`#gradeTable td:nth-child(${subjectIndex + 1})`);
    return Array.from(cells).filter(cell => cell.textContent.trim().startsWith(grade)).length;
}

function calculateSubjectPositions(subjectData) {
    const sortedSubjects = Object.entries(subjectData)
        .sort(([, a], [, b]) => b - a);

    const positions = {};
    let currentPosition = 1;
    let previousScore = null;

    sortedSubjects.forEach(([subject, score], index) => {
        if (score !== previousScore) {
            currentPosition = index + 1;
        }
        positions[subject] = currentPosition;
        previousScore = score;
    });

    return positions;
}

function countGradesForSubject(subject, grade) {
    const isLowerPrimary = ['Primary One', 'Primary Two', 'Primary Three'].includes(classSelect.value);
    let selector;

    if (isLowerPrimary) {
        switch (subject) {
            case 'ENG':
                selector = 'td:nth-child(3)';
                break;
            case 'MTC':
                selector = 'td:nth-child(5)';
                break;
            case 'LIT A':
                selector = 'td:nth-child(6) input';
                return countGradesForLitSubject(selector, grade);
            case 'LIT B':
                selector = 'td:nth-child(7) input';
                return countGradesForLitSubject(selector, grade);
            case 'R.E':
                selector = 'td:nth-child(11)';
                break;
            case 'LIT 2':
                selector = 'td:nth-child(13)';
                break;
            case 'LUG':
                selector = 'td:nth-child(15)';
                break;
            default:
                return 0;
        }
    } else {
        const subjectIndex = ['ENG', 'MTC', 'SCIE', 'SST'].indexOf(subject) * 2 + 2;
        selector = `td:nth-child(${subjectIndex + 1})`;
    }

    const cells = document.querySelectorAll(`#gradeTable ${selector}`);
    return Array.from(cells).filter(cell => cell.textContent.trim().startsWith(grade)).length;
}

function countGradesForLitSubject(selector, grade) {
    const inputs = document.querySelectorAll(`#gradeTable ${selector}`);
    return Array.from(inputs).filter(input => {
        const marks = input.value.trim();
        if (marks === "-") return grade === "X";
        const calculatedGrade = calculateGrade(marks).grade;
        return calculatedGrade === grade;
    }).length;
}

function updateAggregateAnalysisTable() {
    const aggregateRow = document.getElementById('aggregateRow');
    const pupilCountRow = document.getElementById('pupilCountRow');
    
    // Clear existing data
    while (aggregateRow.children.length > 1) {
        aggregateRow.removeChild(aggregateRow.lastChild);
    }
    while (pupilCountRow.children.length > 1) {
        pupilCountRow.removeChild(pupilCountRow.lastChild);
    }

    const aggregateCounts = {};
    const totalAggregateCells = document.querySelectorAll('#gradeTable .total-aggregates');

    totalAggregateCells.forEach(cell => {
        const aggregate = cell.textContent.trim();
        if (aggregate) {
            aggregateCounts[aggregate] = (aggregateCounts[aggregate] || 0) + 1;
        }
    });

    Object.entries(aggregateCounts).sort((a, b) => parseInt(a[0]) - parseInt(b[0])).forEach(([aggregate, count]) => {
        const aggregateTh = document.createElement('th');
        aggregateTh.textContent = aggregate;
        aggregateRow.appendChild(aggregateTh);

        const countTd = document.createElement('td');
        countTd.textContent = count;
        pupilCountRow.appendChild(countTd);
    });
}

        function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;

    const progressBar = document.createElement('div');
    progressBar.className = 'progress-bar';
    const progress = document.createElement('div');
    progress.className = 'progress';
    progressBar.appendChild(progress);
    notification.appendChild(progressBar);

    document.body.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = '1';
    }, 10);

    setTimeout(() => {
        progress.style.width = '100%';
    }, 50);

    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, duration);
}
             // Add this new function to import data
             let filePickerOpened = false;

function importData() {
    const fileInput = document.getElementById('fileInput');
    fileInput.value = ''; // Clear the file input
    filePickerOpened = true;

    fileInput.onchange = function(event) {
        filePickerOpened = false;
        handleFileSelect(event);
    };

    // Use setTimeout to allow the file picker to open before adding the blur event listener
    setTimeout(() => {
        window.addEventListener('focus', checkImportCancelled);
    }, 1000);

    fileInput.click();
}

function checkImportCancelled() {
    const fileInput = document.getElementById('fileInput');
    if (filePickerOpened && !fileInput.value) {
        showNotification("Import cancelled", "info");
    }
    filePickerOpened = false;
    window.removeEventListener('focus', checkImportCancelled);
}

function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const jsonData = JSON.parse(e.target.result);
                populateTableWithImportedData(jsonData);
                showNotification("Data imported successfully!", "success");
            } catch (error) {
                console.error('Error parsing JSON:', error);
                showNotification("Error importing data. Please make sure the file is a valid JSON.", "error");
            }
        };
        reader.readAsText(file);
    }
    // Reset the file input to allow re-importing the same file
    event.target.value = '';
}

// Add event listener for the Import Data button
document.getElementById('importDataBtn').addEventListener('click', importData);

        function populateTableWithImportedData(data) {
    // Set the class and stream selects
    classSelect.value = data.class;
    populateStreamSelect(data.class);
    streamSelect.value = data.stream;

    // Show the grading page
    welcomePage.style.display = 'none';
    gradingPage.style.display = 'block';

    // Set the title
    classStreamTitle.textContent = `${data.class} - ${data.stream}`;

    // Clear existing table rows
    const tableBody = document.getElementById('gradeTableBody');
    tableBody.innerHTML = '';

    // Populate the table with imported data
    data.students.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${student.name}</td>
            <td><input type="text" class="subject-mark" value="${student.math.marks}" required pattern="^\\d+$|^-$" maxlength="3"></td>
            <td class="subject-aggregate">${student.math.marks ? student.math.grade : ''}</td>
            <td><input type="text" class="subject-mark" value="${student.english.marks}" required pattern="^\\d+$|^-$" maxlength="3"></td>
            <td class="subject-aggregate">${student.english.marks ? student.english.grade : ''}</td>
            <td><input type="text" class="subject-mark" value="${student.sst.marks}" required pattern="^\\d+$|^-$" maxlength="3"></td>
            <td class="subject-aggregate">${student.sst.marks ? student.sst.grade : ''}</td>
            <td><input type="text" class="subject-mark" value="${student.science.marks}" required pattern="^\\d+$|^-$" maxlength="3"></td>
            <td class="subject-aggregate">${student.science.marks ? student.science.grade : ''}</td>
            <td class="total-aggregates">${calculateTotalAggregates(student)}</td>
            <td class="division">${calculateDivision(calculateTotalAggregates(student))}</td>
        `;

        const inputs = row.querySelectorAll('.subject-mark');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9-]/g, '');
                validateAndUpdateResults(this);
            });
            input.addEventListener('blur', () => validateAndUpdateResults(input));
        });

        tableBody.appendChild(row);
    });

    // Trigger update for all inputs to recalculate grades and aggregates
    tableBody.querySelectorAll('.subject-mark').forEach(input => {
        validateAndUpdateResults(input);
    });
}
        // Add event listeners for the new Import Data button and file input
        document.getElementById('importDataBtn').addEventListener('click', importData);
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        async function saveDraft() {
    const selectedClass = classSelect.value;
    const selectedStream = streamSelect.value;
    const rows = document.querySelectorAll('#gradeTable tr');
    let jsonData = {
        class: selectedClass,
        stream: selectedStream,
        students: []
    };

    // Skip the header row (index 0)
    for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const columns = row.querySelectorAll('td');
        const studentData = {
            name: columns[0].textContent,
            math: {
                marks: columns[1].querySelector('input').value,
                grade: columns[2].textContent.split(' ')[0] || '',
                aggregates: columns[2].textContent.split('(')[1] ? parseInt(columns[2].textContent.split('(')[1]) : ''
            },
            english: {
                marks: columns[3].querySelector('input').value,
                grade: columns[4].textContent.split(' ')[0] || '',
                aggregates: columns[4].textContent.split('(')[1] ? parseInt(columns[4].textContent.split('(')[1]) : ''
            },
            sst: {
                marks: columns[5].querySelector('input').value,
                grade: columns[6].textContent.split(' ')[0] || '',
                aggregates: columns[6].textContent.split('(')[1] ? parseInt(columns[6].textContent.split('(')[1]) : ''
            },
            science: {
                marks: columns[7].querySelector('input').value,
                grade: columns[8].textContent.split(' ')[0] || '',
                aggregates: columns[8].textContent.split('(')[1] ? parseInt(columns[8].textContent.split('(')[1]) : ''
            },
            totalAggregates: columns[9].textContent,
            division: columns[10].textContent
        };
        jsonData.students.push(studentData);
    }

    // Convert to JSON string
    const jsonString = JSON.stringify(jsonData, null, 2);
    const fileName = `${selectedClass}_${selectedStream}_Draft.json`;

    if ('showSaveFilePicker' in window) {
        try {
            const fileHandle = await window.showSaveFilePicker({
                suggestedName: fileName,
                types: [{
                    description: 'JSON File',
                    accept: {'application/json': ['.json']},
                }],
            });
            const writable = await fileHandle.createWritable();
            await writable.write(jsonString);
            await writable.close();
            console.log('Draft saved successfully using modern API');
            showNotification('Draft saved successfully!', 'success');
        } catch (err) {
            if (err.name === 'AbortError') {
                console.log('User cancelled the save operation');
                showNotification("Draft save cancelled", "info");
            } else {
                console.warn('Error using modern save method:', err);
                showNotification("Error saving draft. Please try again.", "error");
            }
        }
    } else {
        const shouldSave = confirm("Do you want to save the draft?");
        if (shouldSave) {
            fallbackSaveMethod(jsonString, fileName);
            showNotification('Draft saved successfully (using fallback method).', 'success');
        } else {
            showNotification("Draft save cancelled", "info");
        }
    }
}

// Add event listener for the Save Draft button
document.getElementById('saveDraftBtn').addEventListener('click', saveDraft);
const studentData = {
  'Primary One': {
      'Diamonds': [
      'AMPIIRWE DANIELS MUGIZI',
          'ABAHO FIACRE EUGENE',
          'AGASHA ABIGAIL',
          'AKAMPURIRA ARISTARCHUS S.',
          'ALUMA AARON',
          'ASHABA ABIGAIL CHLOE',
          'ATUKUNDA SALOME',
          'BUKENYA POWELL JUNIOR',
          'GANZA HOLLY SHAK',
          'GITTA JAMAL',
          'HIRWA TETA HUGUETTE',
          'JJUKO DRAKE PIUS',
          'JJUUKO RAHMA',
          'KABUYAYA SHANNA',
          'KATEREGGA MUHAMMED AMULI',
          'KATO JESSE',
          'KATUMBA MUGERWA WALLACE',
          'KAYANJA DALTON',
          'KIJJAMBU GRACE',
          'KIRENDA HAVANS KERAMO',
          'KISAKYE ELIANA TENDO',
          'KITENDA GIAN MUKIRIZA',
          'KIYAGA HADIJAH',
          'KUBAGYE ISAIAH',
          'KWAGALA GRAHAM',
          'LUBOWA ABDUL KARIM',
          'LWASA DAVIS',
          'MAGUMBA SHAMYRAH',
          'MAYANJA FABIAN VANVAN',
          'MBOGGA JOEL',
          'MIREMBE LUCY FLAVIA',
          'MUGALU JOSEPH',
          'MUHOZA PRAISE',
          'MUWANGUZI CHRIS DANIEL',
          'MWEBINGWA ELIJAH',
          'NAJJUKO NALUZZI',
          'NAKAAYI ABIGAIL',
          'NALUJJA TIMAYA',
          'NAMULINDWA MIRACLE',
          'NATUHWERA ABIGAIL K.',
          'NAZZIWA ELIANA GRACE',
          'NUWASIIMA ELIJAH JUNIOR',
          'RUGABA CAESAR',
          'SSEBBUMBA ISAAC IQRAM',
          'SSEGAWA JORAM',
          'SSENYANGE FRANK FAVOUR',
          'TIBANYANGA GENESIS',
          'NAKITTO CHLOE',
          'AINEBYONA GABRIEL',
          'AHURIRE JONATHAN',
          'MIGUEL LEVITICUS',
          'MULUNGI RHODAH',
          'SSEMWANGA WILDAN',
          'NANKINGA SHANNEL',
          'ZAWEDDE NADRA'
      ],
      'Pearls': [
        'NANTEZA ATARAH',
          'ADIL KIVIIRI MITTI',
          'ATULINDA CLARA MERISHA',
          'AYONGYERAHO SAMATHA',
          'KABAGAMBE JESUS SPEEDMAN',
          'KIRUNDA EMMANUEL KWAME',
          'KOMAGUM CHRISTIAN JORDANS',
          'KYEYUNE AMIR ADAMS',
          'LAKER LIZBETH',
          'LUSIBA JONNAH',
          'LUTAAYA JOHN WYCLIFF',
          'LUTAAYA JORDIN SAAVA',
          'LUZINDA ELIJAH KISAKYE',
          'MUGARURA SHAROT',
          'MUHUMUZA NEWTON',
          'MUKISA TREASURE',
          'MULUMBA MELISSA MICHELLE',
          'MULUNGI MACKYLA',
          'MULUNGI PRECIOUS PAULA',
          'MUSITWA MARCUS FRANCIS',
          'MUWANGA HAIMA AADIHA',
          'MUYOMBA PAMELLA',
          'MWEBE JAYDEN JUDE',
          'NABAALE MARIA MACKEILA',
          'NABATANZI BLESSING',
          'NABATANZI MARIA',
          'NABUKEERA MARTHA BETTY',
          'NABUMBO BEATRICE',
          'NAGADYA WENDYWEEKS',
          'NAKALINZI VICTORIA NABBIMBA',
          'NAKAYIWA BLESSING',
          'NAKIGUDDE JESCA',
          'NAKITTO SHAMIRAH',
          'NALWADDA MARIANA',
          'NAMAGANDA MARY MUBEEZI',
          'NAMAGEMBE ABIGAIL KIRABILA',
          'NAMAKULA CHRISTINE',
          'NAMBUUSI FIRIDAUS',
          'NAMBUUSI VERONICA NAKATO',
          'NANSUBUGA KELSIE',
          'NANTIMBA JULIAN SEKATE',
          'NASSANGA RIDAH BASINGA',
          'NENDEJYE MARION',
          'NGOGE VIVIAN',
          'OBANG SHAMMAH SANTA',
          'OPI HIRAM ANISON',
          'RABEIA ABDALLAH HAMED',
          'SSEGAWA CLYDE LARKIN',
          'SSERUNJOGI GRANT GILBERT',
          'TUMUSHIME CRYSTAL',
          'YAWE AMBER HADIAH',
          'AKATUKUNDA TRIUMPHANT'
      ],
      'Stars': [
          'ABIGABA MATTHEW',
          'ABIGARURAHO SPLENDID',
          'ACHOLA SAMANTHA',
          'AHIMBISIBWE JEREMIAH',
          'AHIMBISIBWE KEVIN',
          'ALIGUMA EMILLY',
          'ALINDA TIFFANY',
          'AMAANI TRISER TIREH',
          'AMPIIRWE DANIELS',
          'ANZOA FAITH',
          'AQEELAH MWEJUSA',
          'ATUHAIRE TRACY KARUNGI',
          'ATUHIRE ANNA MARY LORETTA',
          'BALIGABYE ABDUL RAHMAN',
          'BIRUNGI KIMORA',
          'BYARUHANGA TRACY',
          'KAGIMU JESHAIAH MELODY',
          'KASIRYE BADURIAH',
          'KASOZI CYRUS MUBIRU',
          'KAVUMA LIBERTY',
          'KENEMA BRILLIANT',
          'KIGGUNDU FRANCIS EXAVIER',
          'KIGOZI CALVIN',
          'KIMBUGWE MUHAMMAD ALI',
          'KIMERA JERICHO',
          'KIMULI ELIJAH',
          'KOBUSINGYE NATALIE',
          'KYOBE JOSIAH MULUNGI',
          'LAKICA  ABIGAIL CHLOE',
          'MAGUMBA JAHIM',
          'MUGERWA EDRINE',
          'MUKISA  HAM',
          'MUKISA JEREMIAH',
          'MULUNGI ASHER NTWALI',
            'MULWANA  MIRACLE NEO',
          'NABIRYE LAILAT',
          'NAKYAZZE NICOLE MALAIKA',
          'NAKYEYUNE MARIA DARLEN',
          'NAMIREMBE JUSTINE NATALIA',
          'NAMPIJJA  RAHUMAH',
          'NANTULYA EZRA',
          'NDAHIRO BRIAN',
          'NIWAGABA  DIVINE',
          'NTEYERA  ABIGAIL ZITA',
          'OLA CHRISLEY',
          'OMENO MAURICE JUNIOR',
          'ONYIRU JOY ECOKU',
          'OWAMAHORO RAUTHA',
          'SAKA RAHIM SUNDAY',
          'SSEKANJAKO TRAVIS VIANNEY',
          'WANDERA JOSIAH',
          'WASSWA JORDAN',
           
      ]  
  },
  'Primary Two': {
  'Golden': [
    'AINE FLOKI',
    'AKANDWANAHO MOBERT',
    'ALOYO JIREH OKOT',
    'AMONDING DORCAS LAURETTA',
    'ANYOLE JAAD GALA',
    'ARINDA LINDSAY',
    'ARINIATWE BASHIRAH',
    'ARIO VICTORIA PRETTY',
    'ASANTE ANTHONY',
    'ASASIRA PHILLIP PROSPER',
    'ATUHAIRE ELLAH MUHABWE',
    'AYEBALE LUCKY',
    'BAKYAZI ZULPHER',
    'BONYA HASHIM TURABI',
    'ISHIMWE NGIRISOKO DEBORAH',
    'KABALI NICHOLAS VICENT',
    'KABUGO ALPHA DICKENS SHINE',
    'KAKANDE ROMANS',
    'KALEMA ELVIS SEJINJA',
    'KAMYUKA RYAN',
    'KASOZI MOSES DALTON',
    'KATENDE DALDAH NAEMU',
    'KAWEESI MELVIN',
    'KAZOOBA CHARLES',
    'KIYAGA EMMANUEL',
    'KOBUSINGYE LAURITAH',
    'KWAGALAKWE TRINITY DIVINE NANSUBUGA',
    'KYOBE HEAVENS MACKLIN',
    'MARIA IVY LUSWATA',
    'MATOVU KEITH WONDER',
    'MBABAZI HILTON MIREMBE',
    'MIREMBE ANNATALIA',
    'MITARI TESSA KANYANA',
    'MUGALU ETHAN MBOWA',
    'MUNIRA SSEKITTO',
    'MUTESI FAIZER NAMULONDO',
    'MUWANGUZI CALVIN',
    'NABUTONO PURITY',
    'NAGAWA ELLA ANNA',
    'NAGGAYI GLORIA',
    'NAKATO BLESSED ABIGAIL',
    'NAKAWOOYA DIVINE',
    'NAKAYIZA MILKAH',
    'NAKIREMBEKA RUTH TENDO ESTHER',
    'NAKIWALA MALAIKA HAZEL',
    'NAMATOVU ABIGAIL SHANIRE',
    'NAMIGADDE KIRABO SHAMIRAH',
    'NAMUGGA VALERIA',
    'NANSAMBA MARTHA MELINA',
    'NANYUNJA ANGEL MYRA',
    'NDAGIRE GENESIS PERUTH',
    'NINSIIMA MARY MERCY',
    'SSEGUYA SHAFIC',
    'SSEMWANGA RODNEY',
    'WALUKAGGA SALIM',
    'MAGALA PRINCE VICTOR',
    'KIRABO TAPHATH'
  ],
  'Kites': [
    'ACEN ANNABEL CAISEY',
    'ADAM SAMA MOKHTAR',
    'AGABA JOHN AUSTIN',
    'AKAMPURIRA CATALEYA RUTH',
    'ALIMPA DESTINY ANGELLA',
    'AMJAD YASIR KASIRYE',
    'ANYIJUKIRE FAVOUR DOLLARS',
    'ASINGUZA JOLLINE',
    'ATUHAIRE PRAISE CYNTHIA',
    'ATUKUNZIRE SPLENDOR',
    'AWADI BENTI SALAH',
    'BAINOMUGISHA ABIDAN',
    'BANADDA HUMAIRAH',
    'BBEMBA SOLOMON DALTON',
    'BUKENYA IMRAN',
    'BUSHIRA HAKIM',
    'DDAMULIRA AMANI KISIRINYA',
    'DDUMBA CANNAN KISAKYE',
    'JOHN KELLY KUTEESA',
    'KARUHANGA KERON ANTONIO',
    'KATENDE PAUL KEIRAH',
    'KAZIBA ERIAS',
    'KIRABO KESHA',
    'KIYEMBA HUSINAH',
    'MASSA RAHUMA',
    'MAYIGA SADAT',
    'MUBIRU RONALD MUSOKE',
    'MUGERWA MARVIN KITIIBWA',
    'MUGISA VALERIE',
    'MUGISHA HARVEST',
    'MUHOOZI ABRAHAM',
    'MUKISA BRINAH AISHA',
    'MUKISA SEAN',
    'MUKOOTA SHAREN',
    'MUSIBIKA SHAHIDAH',
    'MUTAAWE MAJORINE',
    'NABAGULANYI RHONAH',
    'NABATANZI SHURKAT LULU',
    'NABIRYO MELANIE',
    'NABUUMA EVELYN',
    'NAGUJJA MELLISA',
    'NAKACWA SYNTHIA',
    'NAKAFEERO CHLOE KATRINAH',
    'NALUGWA JULIANAH',
    'NALUSOZI MADRINE',
    'NAMBUSI HASIFA LULE',
    'NAMPEEWO RHAUDAH',
    'NAMUDDU JULIET NALUSIBA',
    'NAMUJJUZI CAROL',
    'NANTEZA JULIAN TENDO',
    'NANYANGE EMMANUELLA',
    'NASSUUNA ANNA CHLOE',
    'NGABO ETHAN MAZINGA',
    'NSUBUGA ETHAN SAMUEL',
    'NYANGOMA MARIANA MELLISA',
    'SANYU LOUIS',
    'SEBUTINDE AIDEEN AYAAN',
    'SSALI JORDAN',
    'SSEKAMWA KERONIE',
    'SSEKYANZI DAVAN',
    'SSEMWOGERERE SADDAM',
    'TUMUHAISE BENJAMIN',
    'WALIGGO BERNICE ABRIANNA',
    'WERE PRINCE KAYLEB',
    'WODERO JONATHAN'
  ],
  'Marigold': [
    'ABAASA ALVIN',
    'ABAASA BENJAMIN',
    'ABDUDALLAH AZIZ KIZZA',
    'AGABA RUGABA SOLOMON',
    'AIJUKA ELYNET',
    'AINEMBABAZI AMELIA',
    'ALINDA ETHAN',
    'AMORAH BLESSING',
    'APIO ABIGAIL CAIRA',
    'ASIIMWE RODNEY',
    'ATWIINE JESSY BYAMUKAMA',
    'BAFUWE JOSIAH SIMON',
    'BALIRUNO ARTHUR MUWANGUZI',
    'CHIOMAKA NASHIELLY ABIGAIL',
    'EMMANUELLA CON',
    'INEZA CANDICE',
    'KABBALE MARK BERNARD',
    'KALUNGI PRECIOUS',
    'KALWAZA JAMES AHURIRE',
    'KASIRYE BASHIRAH',
    'KASOZI TRAVAN MUWONGE',
    'KEMBABAZI ELEXANA',
    'KIGOZI ABDUL SHAKUR',
    'KIRYOWA ALOYSIOUS',
    'KISAKYE PAULINE DELISHA',
    'KWAGALA DIVINE SSEBUGUZI',
    'LAGUM NICHOLETTE',
    'LUGENDO SEBASTIAN',
    'LUMU ANDREW',
    'LWANGA SHAFIK BASUDDE',
    'MATOVU JOHN HEIDEN',
    'MATOVU MICAH',
    'MILLA MIRACLE TIMOTHY',
    'MPAIRWE LESLEY LEONAH',
    'MPANDE JEROME',
    'MUHUMUZA GRACE MUTONI',
    'MUKAMA LIAM JONATHAN',
    'MUKIIBI VIANNEY',
    'MUTONI ELISHEBAH ALISON',
    'MUWONGE LUCKY JONATHAN',
    'NAKAYIZA ERINAH SENFUKA',
    'NAKIJOBA AVA GRACE',
    'NALUBEGA DINAH',
    'NAMARA JONAN JASON',
    'NAMBOGO CHRISTABEL',
    'NAMIIRO MONICA CLARA',
    'NANDAWULA MIRIAM',
    'NASSOZI VALORIE BLESSINGS',
    'NDETESHEKO GIFFIN',
    'NOKRACH KEYLOR CRUZ',
    'NSHUTI ELISHA',
    'NTARE MAURICE NABLE',
    'NUWAGABA AARON SHELDON',
    'NYAKATO MARIA MICHELLE',
    'NYOMBI AMIRA',
   'NZIZA ELIJAH',
   'OKOT ADRIEL HISGARACE',
   'OKOTEL EMMANUELLA',
   'OMODING ETHAN EYALAMA',
   'ROHAAN BAHAR',
   'SSALI BENJAMIN',
   'SSANGO JOVAN ANGELLO',
   'SSEBUGWAWO JONATHAN KISLEY',
   'TOMUSANGE KATRINAH',
   'WALAKIRA ALOYSIOUS',
   'WASSWA ABEL BRANDON'
   
  ]
},
  'Primary Three': {
    'Cranes': [
      'AKAMPULIRA CALVIN',
      'BUGEMBE SHAKUR',
      'ANKUNDA DONALD',
      'DDUMBA JORAM',
      'KISIRA JORDAN',
      'KIBUDDE NICHOLAS',
      'KAGIMU SHEMAIAH',
      'KEEYA MALCOM',
      'KYEYUNE DANIEL',
      'LWASA DALTON',
      'LWALANDA HAKIM',
      'ISINGOMA EDGAR',
      'MAGALA DALTON',
      'MUKIIBI JONATHAN',
      'MUKISA TRAJAN',
      'MUWAMBA WILFRED',
      'NKWISANA REAGAN',
      'SSENTONGO SIMON ELVIS',
      'SSIMBWA TALIA',
      'WALUSIMBI JETHRO V.',
      'HIRWA ALLE IAN',
      'TURYAKIRA TYRONE',
      'KAFEERO ELIJAH P',
      'MUGERWA JERICHO',
      'SSEBUUFU RAYMOND',
      'SSEKAJIGO VICTOR',
      'BWIIRE EMMANUEL',
      'LUBEGA MICHAEL',
      'KAWEESI ABDUL S.',
      'TUMUSIIME FRANK',
      'WEBARE GABRIEL',
      'KAWEESI EVANS',
      'KASULE ELIASAFU P.',
      'SSERUYANGE TIMOTHY',
      'MIGADDE SHAKUR S.',
      'SSERUNJOGI ETHAN',
      'MAGUMBA SHAKIR',
      'ADRIKO PROSPER',
      'BUKENYA KRYSTAL N.',
      'BESIGYE TRICIA',
      'BYARUHANGA ASHNAZ',
      'MUKISA FAVOUR',
      'NAKITTO RHONEL R',
      'NANNUNGI ANNA',
      'NAMUBIRU AFRICA',
      'NAKIBONEKA PRUDENCE',
      'NAMAGALA EDRON',
      'NANYEZA LYAN',
      'NAMYALO TASHEEMIM',
      'NAKABUYE CYNTHIA',
      'NASASIRA DIVINE',
      'NAMBEJJA CHRISTINE',
      'NANJEGO VICTORIA',
      'OLA KERON',
      'WAIKYA ISRAELLA P',
      'RASHYM WAHIDAH I.',
      'NABUKEERA SHUKRAN Y',
      'NANKUBUGE SHAINAH',
      'NAKASIISA SHEILAH K.',
      'NAMUYIGA JOVIA',
      'NASSIMBWA GRACE H',
      'NAKIGULI SHIVAN PIA',
      'NAKALANZI PROMISE',
      'KAITESI LEAH',
      'NASSIMBWA CIARA',
      'KAMUGISHA GIOVANA',
      'MPAIRWE CELINE L.',
      'MWESIGWA MILVA',
      'KIGULI NAILOR'
    ],
    'Sparrows': [
      'NAMAZZI HILDA',
      'ABAASA MELISA',
      'NALUYANGE MADRINE',
      'NAMATA SHIFRA K.',
      'NANYUNJA RINAH',
      'NAKALUNGI GABRIELLA',
      'KATUMBA MARIA',
      'ATUHAIRE GEORGIA',
      'TREASURE ELIZABETH SEKU',
      'NAMUTEBI LEONA ROSELLA',
      'NAMUGERWA SABRINA',
      'NAMPIIMA PAULINE',
      'MIREMBE RAUDAH',
      'NYAKATO EDRINAH',
      'AMILA ADAMS KYEYUNE',
      'BWIRE CHLOE GRIGHTON',
      'AKWERO LYNNE A.',
      'ASABA MULUNGI JOANA',
      'NALUBEGA MARIA',
      'AKAMUTUHA JANET',
      'KOMUJUNI FEDRACE',
      'NAMAGANDA BRIANNAH',
      'MUSIIME GIFT',
      'MUYAMA ABIGAIL',
      'NABUKENYA CATE JOSEPHINE',
      'NALWANGA JAZMINE',
      'ARINDA MARTHA',
      'KAVUMA NORINE ESTHER',
      'IRENE MALAIKA NABBALE',
      'NAMANDA MAJORINE',
      'NABBONGOLE KATRINAH',
      'NAMUJJUZI WINFRED',
      'AINEMBABAZI MELISSA',
      'NANSIRUMBI ISABELLA',
      'NAKINTU IMMACULATE',
      'AINEMBABAZI RAINAH GRACE',
      'SANYU NISHA GASARO',
      'BARUNGI VICTORIA',
      'ANVIKO SHANTAL',
      'MALAIKA TRIXIE KIYAGA',
      'NANSUMBI DEBORAH',
      'NDAGIRE SARAH',
      'KALYANGO RAHEEM',
      'WASSWA KABUYE JONAH',
      'KATO KABUYE JOVANS',
      'AGABA JOHN TREASURE',
      'KATUMBA CONRAD',
      'ELOY TITUS SSENTONGO',
      'AHUMUZA PRAISE ROBERT',
      'KAWEESA KEIRAN',
      'BALIKUDDEMBE ELVIS',
      'BATANDA JETHRO',
      'WALUSIMBI MARTIN',
      'KAWEESI HASHIM',
      'SSEWANYANA AARON',
      'TAMALE JOHN FRANCIS',
      'BUYONDO ISRAEL',
      'KWEZI ROBIN',
      'WODERO JOSHUA',
      'SSEMPIJJA OSCAR',
      'MUKIRIZA GEORGE',
      'KALIBBALA AKRAM',
      'ARIIHO ISRAEL',
      'KALYESUBULANJAYDEN',
      'KAKUNGULU RYAN MARK',
      'NTAMBI REAGAN J.',
      'KIMBUGWE ABDULLAH'
    ],
    'Parrots': [
      'AGABA JOSHUA WALTER',
      'ASIIMWE DERRICK',
      'LUGENDO AMOS',
      'ATWIINE JOTHAM',
      'BATANDA DYLAN',
      'BYAMUKAMA KEITH',
      'TAMALE JAKIRA FLAVOUR',
      'KAKOOZA ABDUL RAZAQ',
      'KAKINDA FABIAN',
      'KATO JOLLY JONATHAN',
      'KAVUMA AMIR',
      'KAWEESA SIMPSON',
      'KIBUUKA RAYMOND',
      'KIMBUGWE STEWART',
      'KIMERA JONATHAN',
      'LUBOWA ABUBAKER',
      'LUKWAGO RAYAN',
      'MAGOMA BENHUR',
      'NSUBUGA MICHEAL',
      'SEKATE GODFREY',
      'SSALI MICHEAL',
      'SSEREMBA JEREMIAH',
      'WASSWA DAVID DOUGLAS',
      'MAYANJA VUUBI',
      'SSENYONGA JEREMIAH',
      'NAYEBARE TIMOTHY',
      'AKATUHEREZA MERRICK',
      'SSERUMAGGA JOHN PUTIN',
      'KAWUKI GIPSON',
      'KABAGAMBE WEISSMAN',
      'AINOMUGISHA PETRINAH',
      'AMPUMUZA ELIANAH',
      'ASINGUZA BRENDA',
      'AVGAIL BATZION',
      'KIZITO HANAH FRIEND',
      'KASULE ELSEN ZAWAD',
      'KATUSIIME JASMINE',
      'KISENYI MELLISA MAGGIE',
      'KYALIGONZA JOSEPHINE',
      'LUMU ANGEL FAVOUR',
      'LUTAAYA CATHERINE',
      'MAGOMA BELICIA',
      'NAKANWAGI KEIRAH',
      'NAKIMULI ETHEL',
      'NAMBALIRWA TRUDE',
      'NAMIREMBE MARIA NICOLE',
      'NAMUMBEJJA RYHAN',
      'NASSIWA HAILEY',
      'OKALLO NATASHA ESTHER',
      'NSIIMIRE FAITH',
      'SSEKATE NOELLA',
      'NAMULI COMFORT',
      'WANYENZE MARIANAH',
      'KALUNGI NEIRAH',
      'NANSUBUGA TRACY CAMILLA',
      'NAKIRIJJA CYNTHIA',
      'KYOMUHENDO GRACE',
      'SSENYONJO MERCY',
      'MUHINDO GIAN',
      'NIYIBIZI JERUSA',
      'NANYONGA ZIADAH',
      'MUNEZERO BLESSEN',
      'NANYONJO PATIENCE',
      'KYENYINI COSSILINE',
      'NAKASUMBA ANITAH',
      'NAMIREMBE PENINAH'
    ]
  }
};

// Function to sort students alphabetically
function sortStudents(students) {
    return students.sort((a, b) => a.localeCompare(b));
}

// Sort students in each stream of each class
for (let className in studentData) {
    for (let streamName in studentData[className]) {
        studentData[className][streamName] = sortStudents(studentData[className][streamName]);
    }
}

async function exportToJSON() {
    if (!validateTable()) {
        showNotification("Please correct the errors in the table before exporting.", "error");
        return;
    }

    const selectedClass = classSelect.value;
    const selectedStream = streamSelect.value;
    const rows = document.querySelectorAll('#gradeTable tr');
    let jsonData = {
        class: selectedClass,
        stream: selectedStream,
        students: []
    };

    // Skip the header row (index 0)
    for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        const columns = row.querySelectorAll('td');
        const studentData = {
            name: columns[0].textContent,
            math: {
                marks: columns[1].querySelector('input').value,
                grade: columns[2].textContent.split(' ')[0],
                aggregates: parseInt(columns[2].textContent.split('(')[1])
            },
            english: {
                marks: columns[3].querySelector('input').value,
                grade: columns[4].textContent.split(' ')[0],
                aggregates: parseInt(columns[4].textContent.split('(')[1])
            },
            sst: {
                marks: columns[5].querySelector('input').value,
                grade: columns[6].textContent.split(' ')[0],
                aggregates: parseInt(columns[6].textContent.split('(')[1])
            },
            science: {
                marks: columns[7].querySelector('input').value,
                grade: columns[8].textContent.split(' ')[0],
                aggregates: parseInt(columns[8].textContent.split('(')[1])
            },
            totalAggregates: columns[9].textContent,
            division: columns[10].textContent
        };
        jsonData.students.push(studentData);
    }

    // Convert to JSON string
    const jsonString = JSON.stringify(jsonData, null, 2);
    const fileName = `${selectedClass}_${selectedStream}_Results.json`;

    if ('showSaveFilePicker' in window) {
        try {
            const fileHandle = await window.showSaveFilePicker({
                suggestedName: fileName,
                types: [{
                    description: 'JSON File',
                    accept: {'application/json': ['.json']},
                }],
            });
            const writable = await fileHandle.createWritable();
            await writable.write(jsonString);
            await writable.close();
            console.log('File saved successfully using modern API');
            showNotification("Data exported successfully!", "success");
        } catch (err) {
            if (err.name === 'AbortError') {
                console.log('User cancelled the save operation');
                showNotification("Export cancelled", "info");
            } else {
                console.warn('Error using modern save method:', err);
                showNotification("Error exporting data. Please try again.", "error");
            }
        }
    } else {
        const shouldSave = confirm("Do you want to save the file?");
        if (shouldSave) {
            fallbackSaveMethod(jsonString, fileName);
            showNotification("Data exported successfully (using fallback method).", "success");
        } else {
            showNotification("Export cancelled", "info");
        }
    }
}

function fallbackSaveMethod(content, fileName) {
    const blob = new Blob([content], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = fileName;
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    setTimeout(() => {
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }, 100);
}

// Update the event listener
document.getElementById('exportBtn').addEventListener('click', exportToJSON);

const classSelect = document.getElementById('classSelect');
const streamSelect = document.getElementById('streamSelect');
const goToGradingBtn = document.getElementById('goToGradingBtn');

// Function to populate the class select
function populateClassSelect() {
    classSelect.innerHTML = '<option value="" disabled selected>Select Class</option>';
    for (const className in studentData) {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = className;
        classSelect.appendChild(option);
    }
}

// Function to populate the stream select based on the selected class
function populateStreamSelect(className) {
    streamSelect.innerHTML = '<option value="" disabled selected>Select Stream</option>';
    if (studentData[className]) {
        for (const streamName in studentData[className]) {
            const option = document.createElement('option');
            option.value = streamName;
            option.textContent = streamName;
            streamSelect.appendChild(option);
        }
        streamSelect.style.display = 'block';
    } else {
        streamSelect.style.display = 'none';
        goToGradingBtn.style.display = 'none';
    }
}

// Populate the class select when the page loads
populateClassSelect();

// Event listener for class select
classSelect.addEventListener('change', function() {
    if (this.value) {
        populateStreamSelect(this.value);
        streamSelect.style.display = 'block';
    } else {
        streamSelect.style.display = 'none';
        goToGradingBtn.style.display = 'none';
    }
});

// Event listener for stream select
streamSelect.addEventListener('change', function() {
    goToGradingBtn.style.display = this.value ? 'block' : 'none';
});

goToGradingBtn.addEventListener('click', function() {
    const selectedClass = classSelect.value;
    const selectedStream = streamSelect.value;
    classStreamTitle.textContent = `${selectedClass} - ${selectedStream}`;
    createTableRows(studentData[selectedClass][selectedStream]);
    welcomePage.style.display = 'none';
    gradingPage.style.display = 'block';
    showNotification(`Grading page loaded for ${selectedClass} - ${selectedStream}`, "info");
});

// Function to calculate grade and aggregates based on marks
function calculateGrade(marks) {
    if (marks === "-") return { grade: "X", aggregates: null };
    if (marks === "") return { grade: "", aggregates: null };
    marks = parseFloat(marks);
    if (isNaN(marks) || marks < 0 || marks > 100) return { grade: "", aggregates: null };
    
    if (marks >= 90) return { grade: "D1", aggregates: 1 };
    if (marks >= 80) return { grade: "D2", aggregates: 2 };
    if (marks >= 70) return { grade: "C3", aggregates: 3 };
    if (marks >= 65) return { grade: "C4", aggregates: 4 };
    if (marks >= 60) return { grade: "C5", aggregates: 5 };
    if (marks >= 55) return { grade: "C6", aggregates: 6 };
    if (marks >= 50) return { grade: "P7", aggregates: 7 };
    if (marks >= 40) return { grade: "P8", aggregates: 8 };
    return { grade: "F9", aggregates: 9 };
}

// Function to calculate division based on total aggregates
function calculateOverallResult(totalAggregates, hasMissedExam, hasF9) {
    if (hasMissedExam) {
        return { totalAggregates, division: 'X' };
    }
    let division = calculateDivision(totalAggregates);
    if (division === "1" && hasF9) {
        division = "2";
    }
    return { totalAggregates, division };
}



function calculateDivision(totalAggregates) {
    if (totalAggregates >= 4 && totalAggregates <= 12) return "1";
    if (totalAggregates >= 13 && totalAggregates <= 24) return "2";
    if (totalAggregates >= 25 && totalAggregates <= 28) return "3";
    if (totalAggregates >= 29 && totalAggregates <= 32) return "4";
    return "U"; // This covers cases where totalAggregates > 32
}

function calculateTotalAggregates(row) {
    const aggregateCells = row.querySelectorAll('.subject-aggregate:not(.minor-subject)');
    let totalAggregates = 0;
    let validAggregates = 0;

    aggregateCells.forEach(cell => {
        const aggregateText = cell.textContent.trim();
        if (aggregateText) {
            totalAggregates += parseInt(aggregateText.match(/\d+/)[0]);
            validAggregates++;
        }
    });

    return validAggregates === 5 ? totalAggregates : ''; // 5 main subjects including RE
}

function updateResults(input) {
    const row = input.closest('tr');
    const marks = input.value.trim();
    
    if (!input.classList.contains('re-subject')) {
        const aggregateCell = input.parentElement.nextElementSibling;
        if (marks === "") {
            aggregateCell.textContent = "";
        } else {
            const { grade, aggregates } = calculateGrade(marks);
            aggregateCell.textContent = grade;
        }
    }

    // Handle RE mean calculation
    if (input.classList.contains('re-subject')) {
        updateREResults(row);
    }

    // Update total aggregates and division
    updateTotalAggregates(row);
    updateAnalysisTables();
  
}

function updateREResults(row) {
    const reInputs = row.querySelectorAll('.re-subject');
    const reMeanCell = row.querySelector('.re-mean');
    const reAggregateCell = row.querySelector('.re-aggregate');
    
    let total = 0;
    let validInputs = 0;
    let hasMissedExam = false;
    reInputs.forEach(reInput => {
        if (reInput.value.trim() === "-") {
            hasMissedExam = true;
        } else if (reInput.value.trim() !== "") {
            total += parseFloat(reInput.value);
            validInputs++;
        }
    });
    
    if (hasMissedExam) {
        reMeanCell.textContent = "-";
        reAggregateCell.textContent = "X";
    } else if (validInputs === 2) {
        const mean = Math.round(total / 2);
        reMeanCell.textContent = mean;
        const { grade, aggregates } = calculateGrade(mean.toString());
        reAggregateCell.textContent = grade;
    } else {
        reMeanCell.textContent = "";
        reAggregateCell.textContent = "";
    }
}

function updateTotalAggregates(row) {
    const isLowerPrimary = ['Primary One', 'Primary Two', 'Primary Three'].includes(classSelect.value);
    const mainSubjectInputs = row.querySelectorAll('.subject-mark.main-subject');
    const mainSubjectAggregates = row.querySelectorAll('.subject-aggregate:not(.minor-subject), .re-aggregate');
    let totalAggregates = 0;
    let validAggregates = 0;
    let hasMissedExam = false;

    mainSubjectInputs.forEach(input => {
        if (input.value.trim() === '-') {
            hasMissedExam = true;
        }
    });

    mainSubjectAggregates.forEach(cell => {
        const aggregateText = cell.textContent.trim();
        if (aggregateText && aggregateText !== 'X') {
            totalAggregates += parseInt(aggregateText.match(/\d+/)[0]);
            validAggregates++;
        } else if (aggregateText === 'X') {
            hasMissedExam = true;
        }
    });

    const totalAggregatesCell = row.querySelector('.total-aggregates');
    const divisionCell = row.querySelector('.division');

    const requiredAggregates = isLowerPrimary ? 4 : 5; // 3 main subjects + RE for lower primary, 4 main subjects + RE for upper primary

    if (hasMissedExam) {
        totalAggregatesCell.textContent = '-';
        divisionCell.textContent = 'X';
    } else if (validAggregates === requiredAggregates) {
        totalAggregatesCell.textContent = totalAggregates;
        divisionCell.textContent = calculateDivision(totalAggregates);
    } else {
        totalAggregatesCell.textContent = '';
        divisionCell.textContent = '';
    }
}

function validateTable() {
    const inputs = document.querySelectorAll('.subject-mark');
    let isValid = true;
    
    inputs.forEach(input => {
        const value = input.value.trim();
        if (value === "-") {
            input.setCustomValidity(""); // Clear any previous validation message
        } else {
            const numValue = parseFloat(value);
            if (value === "" || isNaN(numValue) || numValue < 0 || numValue > 100) {
                isValid = false;
                input.setCustomValidity("Please enter a number between 0 and 100, or '-' for no score.");
            } else {
                input.setCustomValidity(""); // Clear any previous validation message
            }
        }
        input.reportValidity();
    });
    
    return isValid;
}

function createTableRows(studentList) {
    const tableBody = document.getElementById('gradeTableBody');
    const tableHeader = document.getElementById('gradeTableHeader');
    tableBody.innerHTML = '';
    
    const selectedClass = classSelect.value;
    const isLowerPrimary = ['Primary One', 'Primary Two', 'Primary Three'].includes(selectedClass);
    const isPrimaryThree = selectedClass === 'Primary Three';
    
    // Update table header
    if (isLowerPrimary) {
        let headerHTML = `
            <tr>
                <th>Name</th>
                <th>ENG</th>
                <th>Agg</th>
                <th>MTC</th>
                <th>Agg</th>
                <th>LIT A</th>
                <th>LIT B</th>
                <th>AVG</th>
                <th>Agg</th>
                <th>R.E</th>
                <th>Agg</th>
                <th>LIT 2</th>
                <th>Agg</th>
                <th>LUG</th>
                <th>Agg</th>
        `;
        if (isPrimaryThree) {
            headerHTML += `
                <th>ICT</th>
                <th>Agg</th>
            `;
        }
        headerHTML += `
                <th>TAG</th>
                <th>Div</th>
            </tr>
        `;
        tableHeader.innerHTML = headerHTML;
    } else {
        tableHeader.innerHTML = `
            <tr>
                <th>Name</th>
                <th>ENG</th>
                <th>Agg</th>
                <th>MTC</th>
                <th>Agg</th>
                <th>SCIE</th>
                <th>Agg</th>
                <th>SST</th>
                <th>Agg</th>
                <th>ICT</th>
                <th>Agg</th>
                <th>KISW</th>
                <th>Agg</th>
                <th>Total Agg</th>
                <th>Div</th>
            </tr>
        `;
    }

    studentList.forEach((student, rowIndex) => {
        const row = document.createElement('tr');
        let rowHTML;
        
        if (isLowerPrimary) {
            rowHTML = `
            <td class="name-cell">
                ${rowIndex + 1}. <span class="student-name">${student}</span>
                <div class="name-options">
                    <button class="edit-name">Edit</button>
                    <button class="delete-name">Delete</button>
                </div>
            </td>
          <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark main-subject re-subject" data-subject="LIT A" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td><input type="text" class="subject-mark main-subject re-subject" data-subject="LIT B" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="re-mean"></td>
                <td class="re-aggregate"></td>
                <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark minor-subject" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate minor-subject"></td>
                <td><input type="text" class="subject-mark minor-subject" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate minor-subject"></td>
            `;
            if (isPrimaryThree) {
                rowHTML += `
                    <td><input type="text" class="subject-mark minor-subject" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                    <td class="subject-aggregate minor-subject"></td>
                `;
            }
            rowHTML += `
                <td class="total-aggregates"></td>
                <td class="division"></td>
            `;
        } else {
            rowHTML = `
                <td class="name-cell">${rowIndex + 1}. <span class="student-name">${student}</span></td>
                <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark main-subject" required pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate"></td>
                <td><input type="text" class="subject-mark minor-subject" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate minor-subject"></td>
                <td><input type="text" class="subject-mark minor-subject" pattern="^\\d+(\\.\\d+)?$|^-$" maxlength="5"></td>
                <td class="subject-aggregate minor-subject"></td>
                <td class="total-aggregates"></td>
                <td class="division"></td>
            `;
        }
        
        row.innerHTML = rowHTML;
        tableBody.appendChild(row);

        // Add event listeners for name CRUD operations
        const nameCell = row.querySelector('.name-cell');
        const nameSpan = nameCell.querySelector('.student-name');
        const nameOptions = nameCell.querySelector('.name-options');

        nameCell.addEventListener('click', (e) => {
            if (e.target === nameCell || e.target === nameSpan) {
                nameOptions.style.display = 'inline-block';
            }
        });

        document.addEventListener('click', (e) => {
            if (!nameCell.contains(e.target)) {
                nameOptions.style.display = 'none';
            }
        });

        const editButton = nameOptions.querySelector('.edit-name');
        const deleteButton = nameOptions.querySelector('.delete-name');

        editButton.addEventListener('click', () => {
            showModel('edit', student, (newName) => {
                nameSpan.textContent = newName;
                updateAnalysisTables();
            });
        });

        deleteButton.addEventListener('click', () => {
            showModel('delete', student, () => {
                row.remove();
                updateRowNumbers();
                updateAnalysisTables();
            });
        });
    });

    function showModel(action, studentName, callback) {
    const model = document.createElement('div');
    model.className = 'model';
    model.innerHTML = `
        <div class="model-content">
            <h2>${action === 'edit' ? 'Edit Student Name' : 'Delete Student'}</h2>
            ${action === 'edit' 
                ? `<input type="text" id="editNameInput" value="${studentName}" placeholder="Enter student name">`
                : `<p>Are you sure you want to delete ${studentName}?</p>`
            }
            <div class="model-buttons">
                <button id="confirmButton">${action === 'edit' ? 'Save' : 'Delete'}</button>
                <button id="cancelButton">Cancel</button>
            </div>
        </div>
    `;

    document.body.appendChild(model);

    const confirmButton = model.querySelector('#confirmButton');
    const cancelButton = model.querySelector('#cancelButton');

confirmButton.addEventListener('click', () => {
    if (action === 'edit') {
        const newName = model.querySelector('#editNameInput').value;
        callback(newName);
        showFlashMessage(`${studentName}'s name updated to ${newName} successfully!`);
    } else {
        callback();
        showFlashMessage(`${studentName} deleted successfully!`);
    }
    closeModel(model);
});

    cancelButton.addEventListener('click', () => {
        closeModel(model);
        showFlashMessage('Operation cancelled');
    });
}

function closeModel(model) {
    document.body.removeChild(model);
}

function showFlashMessage(message) {
    const flashMessage = document.createElement('div');
    flashMessage.className = 'flash-message';
    flashMessage.textContent = message;

    document.body.appendChild(flashMessage);

    setTimeout(() => {
        flashMessage.classList.add('fade-out');
        setTimeout(() => {
            document.body.removeChild(flashMessage);
        }, 500);
    }, 3000);
}

    const allInputs = tableBody.querySelectorAll('.subject-mark');
    allInputs.forEach((input, index) => {
        input.addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9-]/g, '');
            validateAndUpdateResults(this);
            
            // Check if the input is complete and valid before moving to the next cell
            const numValue = parseInt(this.value);
            if ((numValue > 10 && numValue < 100) || this.value === '-' || this.value === '100') {
                if (index < allInputs.length - 1) {
                    allInputs[index + 1].focus();
                }
            }
        });
        input.addEventListener('keydown', function(e) {
            // ... (keep the existing keydown event listener)
        });
        input.addEventListener('blur', () => validateAndUpdateResults(input));
    });
}

function showModal(action, studentName, callback) {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2>${action === 'edit' ? 'Edit Student Name' : 'Delete Student'}</h2>
            ${action === 'edit' 
                ? `<input type="text" id="editNameInput" value="${studentName}">`
                : `<p>Are you sure you want to delete ${studentName}?</p>`
            }
            <div class="modal-buttons">
                <button id="confirmButton">${action === 'edit' ? 'Save' : 'Delete'}</button>
                <button id="cancelButton">Cancel</button>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    const confirmButton = modal.querySelector('#confirmButton');
    const cancelButton = modal.querySelector('#cancelButton');

    confirmButton.addEventListener('click', () => {
        if (action === 'edit') {
            const newName = modal.querySelector('#editNameInput').value;
            callback(newName);
        } else {
            callback();
        }
        document.body.removeChild(modal);
    });

    cancelButton.addEventListener('click', () => {
        document.body.removeChild(modal);
    });
}

function showFlashMessage(message) {
    const flashMessage = document.createElement('div');
    flashMessage.className = 'flash-message';
    flashMessage.textContent = message;

    document.body.appendChild(flashMessage);

    setTimeout(() => {
        flashMessage.classList.add('fade-out');
        setTimeout(() => {
            document.body.removeChild(flashMessage);
        }, 500);
    }, 3000);
}

function updateRowNumbers() {
    const rows = document.querySelectorAll('#gradeTableBody tr');
    rows.forEach((row, index) => {
        const nameCell = row.querySelector('.name-cell');
        const numberSpan = nameCell.firstChild;
        numberSpan.textContent = `${index + 1}. `;
    });
}



function handleInputChange(input) {
    const value = input.value;
    if (value === '-' || value === '100' || (value.length === 2 && parseInt(value) >= 11 && parseInt(value) <= 99)) {
        moveToNextInput(input);
    }
}

function moveToNextInput(currentInput) {
    // Add leading zero if necessary
    if (currentInput.value.length === 1 && parseInt(currentInput.value) >= 0 && parseInt(currentInput.value) <= 9) {
        currentInput.value = '0' + currentInput.value;
    }

    const currentCell = currentInput.parentElement;
    const currentRow = currentCell.parentElement;
    const cells = Array.from(currentRow.cells);
    const currentIndex = cells.indexOf(currentCell);
    
    // Find the next input field
    for (let i = currentIndex + 1; i < cells.length; i++) {
        const nextInput = cells[i].querySelector('input');
        if (nextInput) {
            nextInput.focus();
            nextInput.select();  // Select the text in the next input
            return;
        }
    }
    
    // If we're at the last cell of the current row, move to the first cell of the next row
    const nextRow = currentRow.nextElementSibling;
    if (nextRow) {
        const firstInput = nextRow.querySelector('input');
        if (firstInput) {
            firstInput.focus();
            firstInput.select();  // Select the text in the next input
        }
    }
}

function validateAndUpdateResults(input) {
    const value = input.value.trim();
    
    if (value === "-") {
        input.setCustomValidity("");
        input.classList.remove('invalid-input');
    } else if (value === "") {
        input.setCustomValidity("This field is required. Enter a number or '-' for no score.");
        input.classList.add('invalid-input');
    } else {
        const numValue = parseFloat(value);
        if (isNaN(numValue)) {
            input.setCustomValidity("Please enter a valid number between 0 and 100, or '-' for no score.");
            input.classList.add('invalid-input');
        } else if (numValue < 0 || numValue > 100) {
            input.setCustomValidity("Please enter a number between 0 and 100.");
            input.classList.add('invalid-input');
        } else {
            input.setCustomValidity("");
            input.classList.remove('invalid-input');
        }
    }
    
    updateResults(input);
}
    </script>
</body>
</html>